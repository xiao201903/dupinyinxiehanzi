<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>çœ‹æ‹¼éŸ³å†™è¯è¯­ä¸“ä¸šç”Ÿæˆå·¥å…·</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <link href="https://fonts.googleapis.com/css2?family=Andika&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --grid-size: 60px;
            --grid-color: #333;
            --pinyin-size: 24px;
            --hanzi-size: 36px;
            --row-gap: 20px;
            --word-gap: 30px;
        }

        * { box-sizing: border-box; }
        body { margin: 0; background: #f1f5f9; font-family: 'Noto Sans SC', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* å·¦ä¾§é…ç½®é¢æ¿ */
        .sidebar { width: 380px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.05); z-index: 10; }
        .config-scroll { padding: 20px; overflow-y: auto; flex: 1; }
        .control-group { margin-bottom: 24px; border-bottom: 1px solid #f1f5f9; padding-bottom: 15px; }
        .group-title { font-size: 15px; font-weight: 700; color: #1e293b; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        
        /* è¾“å…¥æ§ä»¶æ ·å¼ */
        .item-label { display: block; font-size: 13px; color: #64748b; margin: 10px 0 5px; }
        input[type="text"], textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; }
        .slider-box { display: flex; align-items: center; gap: 10px; margin: 8px 0; }
        input[type="range"] { flex: 1; accent-color: var(--primary); }
        .val-tag { min-width: 45px; font-size: 12px; color: var(--primary); font-weight: bold; }

        /* å¤é€‰æ¡†/å•é€‰æ¡†æ ·å¼ */
        .check-group { display: flex; flex-wrap: wrap; gap: 12px; margin: 10px 0; }
        .check-item { display: flex; align-items: center; gap: 5px; font-size: 13px; cursor: pointer; }

        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-area { flex: 1; background: #94a3b8; overflow: auto; padding: 40px; display: flex; flex-direction: column; align-items: center; }
        .sheet { width: 210mm; height: 297mm; background: white; padding: 15mm; box-shadow: 0 10px 25px rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; flex-shrink: 0; }

        /* é¢„è§ˆå†…å®¹æ’ç‰ˆ */
        .sheet-header { text-align: center; margin-bottom: 8mm; }
        .sheet-title { font-size: 28px; font-weight: bold; margin-bottom: 4mm; }
        .sheet-meta { display: flex; justify-content: center; gap: 10mm; font-size: 14px; margin-bottom: 5mm; }
        .meta-item span { border-bottom: 1px solid #000; padding: 0 15px; min-width: 60px; display: inline-block; }

        .sheet-content { flex: 1; display: flex; flex-wrap: wrap; align-content: flex-start; row-gap: var(--row-gap); column-gap: var(--word-gap); }
        .word-block { display: flex; break-inside: avoid; }
        .char-unit { display: flex; flex-direction: column; align-items: center; }
        
        .pinyin-box { height: 30px; font-family: 'Andika', sans-serif; font-size: var(--pinyin-size); color: #333; display: flex; align-items: flex-end; }
        .grid-box { width: var(--grid-size); height: var(--grid-size); border: 1px solid var(--grid-color); position: relative; margin-left: -1px; display: flex; justify-content: center; align-items: center; }
        .char-unit:first-child .grid-box { margin-left: 0; }

        /* æ±‰å­—å±‚ */
        .hanzi-content { font-family: "æ¥·ä½“", "KaiTi", serif; font-size: var(--hanzi-size); color: #333; position: absolute; }
        .hanzi-trace { color: rgba(0,0,0,0.15); } /* æçº¢æ•ˆæœ */

        /* æ ¼çº¿ SVG */
        .bg-tian { background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3C/svg%3E"); }
        .bg-mi { background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3Cline x1='0' y1='0' x2='100%25' y2='100%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3Cline x1='100%25' y1='0' x2='0' y2='100%25' stroke='%23d32f2f' stroke-width='0.5' stroke-dasharray='3,3'/%3E%3C/svg%3E"); }

        .btn-export { width: 100%; padding: 15px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        
        @media print {
            .sidebar { display: none; }
            .preview-area { padding: 0; background: white; }
            .sheet { margin: 0; box-shadow: none; border: none; }
        }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="config-scroll">
        <div class="group-title">H æ ‡é¢˜è®¾ç½®</div>
        <input type="text" id="docTitle" value="çœ‹æ‹¼éŸ³å†™è¯è¯­ç»ƒä¹ " oninput="render()">
        
        <div class="group-title" style="margin-top:20px;">ğŸ“ è¯è¯­å½•å…¥</div>
        <textarea id="wordInput" rows="6" oninput="render()" placeholder="ä½ å¥½&#10;è¿™æ˜¯*&#10;æ—©ä¸Š*">ä½ å¥½&#10;è¿™æ˜¯*&#10;æ—©ä¸Š*&#10;æ‹¼éŸ³&#10;ç»ƒä¹ *</textarea>
        
        <div class="group-title" style="margin-top:20px;">ğŸ“Š æ ¼å¼è®¾ç½®</div>
        
        <span class="item-label">æ ¼çº¿ç±»å‹</span>
        <div class="check-group">
            <label class="check-item"><input type="radio" name="gridType" value="tian" checked onchange="render()"> ç”°å­—æ ¼</label>
            <label class="check-item"><input type="radio" name="gridType" value="mi" onchange="render()"> ç±³å­—æ ¼</label>
        </div>

        <span class="item-label">è¡¨å¤´è®¾ç½®</span>
        <div class="check-group">
            <label class="check-item"><input type="checkbox" id="showClass" checked onchange="render()"> ç¬¬ä¸€æ (ç­çº§)</label>
            <label class="check-item"><input type="checkbox" id="showName" checked onchange="render()"> ç¬¬äºŒæ (å§“å)</label>
            <label class="check-item"><input type="checkbox" id="showScore" checked onchange="render()"> ç¬¬ä¸‰æ (å¾—åˆ†)</label>
        </div>

        <span class="item-label">æ ¼å­å¤§å°: <span id="sizeVal" class="val-tag">60px</span></span>
        <input type="range" id="sizeRange" min="40" max="100" value="60" oninput="updateStyles()">

        <span class="item-label">æ ¼å­é—´è·: <span id="wordGapVal" class="val-tag">30px</span></span>
        <input type="range" id="wordGapRange" min="0" max="50" value="30" oninput="updateStyles()">

        <span class="item-label">è¡Œé—´è·: <span id="rowGapVal" class="val-tag">20px</span></span>
        <input type="range" id="rowGapRange" min="10" max="60" value="20" oninput="updateStyles()">

        <span class="item-label">æ‹¼éŸ³å­—ä½“å¤§å°: <span id="pySizeVal" class="val-tag">24px</span></span>
        <input type="range" id="pySizeRange" min="12" max="40" value="24" oninput="updateStyles()">

        <span class="item-label">æ±‰å­—å­—ä½“å¤§å°: <span id="hzSizeVal" class="val-tag">36px</span></span>
        <input type="range" id="hzSizeRange" min="20" max="80" value="36" oninput="updateStyles()">

        <button class="btn-export" onclick="window.print()">ğŸ“¥ å¯¼å‡º PDF</button>
    </div>
</aside>

<main class="preview-area" id="previewArea"></main>

<script>
    const { pinyin } = pinyinPro;

    function updateStyles() {
        const root = document.documentElement;
        const size = document.getElementById('sizeRange').value;
        const wordGap = document.getElementById('wordGapRange').value;
        const rowGap = document.getElementById('rowGapRange').value;
        const pySize = document.getElementById('pySizeRange').value;
        const hzSize = document.getElementById('hzSizeRange').value;

        document.getElementById('sizeVal').innerText = size + 'px';
        document.getElementById('wordGapVal').innerText = wordGap + 'px';
        document.getElementById('rowGapVal').innerText = rowGap + 'px';
        document.getElementById('pySizeVal').innerText = pySize + 'px';
        document.getElementById('hzSizeVal').innerText = hzSize + 'px';

        root.style.setProperty('--grid-size', size + 'px');
        root.style.setProperty('--word-gap', wordGap + 'px');
        root.style.setProperty('--row-gap', rowGap + 'px');
        root.style.setProperty('--pinyin-size', pySize + 'px');
        root.style.setProperty('--hanzi-size', hzSize + 'px');
    }

    function render() {
        const previewArea = document.getElementById('previewArea');
        previewArea.innerHTML = '';
        
        const title = document.getElementById('docTitle').value;
        const wordInput = document.getElementById('wordInput').value;
        const gridType = document.querySelector('input[name="gridType"]:checked').value;
        const bgClass = gridType === 'tian' ? 'bg-tian' : 'bg-mi';

        // åˆ›å»ºé¡µé¢
        const sheet = document.createElement('div');
        sheet.className = 'sheet';
        
        // è¡¨å¤´
        let metaHTML = '';
        if(document.getElementById('showClass').checked) metaHTML += `<div class="meta-item">ç­çº§ï¼š<span></span></div>`;
        if(document.getElementById('showName').checked) metaHTML += `<div class="meta-item">å§“åï¼š<span></span></div>`;
        if(document.getElementById('showScore').checked) metaHTML += `<div class="meta-item">å¾—åˆ†ï¼š<span></span></div>`;

        sheet.innerHTML = `
            <div class="sheet-header">
                <div class="sheet-title">${title}</div>
                <div class="sheet-meta">${metaHTML}</div>
            </div>
            <div class="sheet-content"></div>
        `;
        previewArea.appendChild(sheet);
        const content = sheet.querySelector('.sheet-content');

        // æ¸²æŸ“è¯è¯­
        wordInput.split('\n').forEach(line => {
            const word = line.trim();
            if(!word) return;

            const wordBlock = document.createElement('div');
            wordBlock.className = 'word-block';

            // æå–æ±‰å­—å’Œæ˜¯å¦å¸¦æ˜Ÿå·
            const chars = word.replace(/\*/g, '').split('');
            const pinyins = pinyin(word.replace(/\*/g, ''), { type: 'array' });

            chars.forEach((char, idx) => {
                const isHint = word.includes(char + '*');
                const unit = document.createElement('div');
                unit.className = 'char-unit';
                unit.innerHTML = `
                    <div class="pinyin-box">${pinyins[idx]}</div>
                    <div class="grid-box ${bgClass}">
                        ${isHint ? `<div class="hanzi-content">${char}</div>` : ''}
                    </div>
                `;
                wordBlock.appendChild(unit);
            });
            content.appendChild(wordBlock);
        });
    }

    window.onload = () => {
        updateStyles();
        render();
    }
</script>
</body>
</html>
