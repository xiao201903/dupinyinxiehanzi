<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™æçº§æ‹¼éŸ³å­—å¸–ç”Ÿæˆå™¨ - ç¾åŒ–ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Andika&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- å­—å¸–æ ¸å¿ƒå‚æ•° --- */
            --grid-size: 18mm;
            --p-top: 20mm; --p-bottom: 20mm; --p-left: 20mm; --p-right: 20mm;
            --row-gap: 12mm;
            --grid-color: #d32f2f; /* å¢¨çº¢è‰² */
            /* å­—ä½“ä¼˜å…ˆçº§ï¼šæ•™æä¸“ç”¨ä½“(Andika) -> æ¥·ä½“ -> ç³»ç»Ÿå¤‡é€‰ */
            --pinyin-font: 'Andika', "STKaiti", "KaiTi", "æ¥·ä½“", serif;

            /* --- UI ä¸»é¢˜è‰² --- */
            --primary-color: #4f46e5; /* é›é’è‰² */
            --bg-color: #f3f4f6;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border-color: #e5e7eb;
        }
        
        body { margin: 0; background: var(--bg-color); font-family: 'Noto Sans SC', -apple-system, sans-serif; display: flex; color: var(--text-main); }
        
        /* --- å·¦ä¾§é¢„è§ˆåŒº --- */
        #viewport { flex-grow: 1; height: 100vh; overflow-y: auto; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; }

        .page {
            width: 210mm; height: 297mm;
            padding: var(--p-top) var(--p-right) var(--p-bottom) var(--p-left);
            background: #fff; 
            /* æ›´æ‹ŸçœŸçš„çº¸å¼ é˜´å½± */
            box-shadow: 0 8px 24px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.04);
            box-sizing: border-box; display: flex; flex-direction: column; 
            position: relative; page-break-after: always; margin-bottom: 40px;
            /* å¾®å¼±çš„çº¸å¼ çº¹ç†æ„Ÿ */
            background-image: linear-gradient(to bottom, #fffcfc, #fff);
        }

        .page-header-title { text-align: center; font-size: 26px; font-weight: 700; color: #222; margin-bottom: 8mm; letter-spacing: 3px; }

        .info-bar {
            display: flex; justify-content: space-between; font-size: 14px; color: #555;
            /* ä½¿ç”¨è™šçº¿åº•è¾¹æ¡† */
            border-bottom: 1.5px dashed var(--grid-color); padding-bottom: 8px; margin-bottom: 12mm;
            padding-left: 5mm; padding-right: 5mm;
        }
        .info-item span { color: var(--grid-color); opacity: 0.3; }

        .render-area { display: flex; flex-wrap: wrap; gap: var(--row-gap) 8mm; align-content: flex-start; flex-grow: 1; }

        .page-footer { position: absolute; bottom: 12mm; left: 0; right: 0; text-align: center; font-size: 12px; color: #aaa; counter-increment: pageCounter; letter-spacing: 1px;}
        .page-footer::after { content: "- ç¬¬ " counter(pageCounter) " é¡µ -"; }

        .word-group { display: flex; break-inside: avoid; }
        .char-unit { display: flex; flex-direction: column; align-items: center; }

        /* æ‹¼éŸ³æ ·å¼ */
        .pinyin { 
            height: 11mm; font-family: var(--pinyin-font); font-size: 20pt; 
            color: #222; margin-bottom: 2.5mm; display: flex; align-items: flex-end; 
            font-variant-ligatures: none;
        }

        /* ç”°å­—æ ¼ï¼šå¤–å®å†…è™š (SVG) */
        .tian-zi-ge { 
            width: var(--grid-size); height: var(--grid-size); 
            border: 2px solid var(--grid-color);
            position: relative; box-sizing: border-box; margin-left: -2px;
            border-radius: 1px; /* æå…¶å¾®å°çš„åœ†è§’è®©è§†è§‰æ›´æŸ”å’Œ */
        }
        .char-unit:first-child .tian-zi-ge { margin-left: 0; }
        .type-tian {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='%23d32f2f' stroke-width='1.2' stroke-dasharray='5,4'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='%23d32f2f' stroke-width='1.2' stroke-dasharray='5,4'/%3E%3C/svg%3E");
        }

        /* --- å³ä¾§æ§åˆ¶é¢æ¿ (ç¾åŒ–æ ¸å¿ƒåŒº) --- */
        .panel {
            width: 360px; height: 100vh; background: #fff; border-left: 1px solid var(--border-color);
            padding: 0; box-sizing: border-box; display: flex; flex-direction: column;
            position: sticky; top: 0; overflow-y: auto;
            box-shadow: -4px 0 16px rgba(0,0,0,0.03);
        }
        
        .panel-header {
            padding: 20px; background: #fff; border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 10;
        }
        h2 { font-size: 18px; color: var(--text-main); margin: 0; display: flex; align-items: center; gap: 10px; font-weight: 700; }
        h2::before { content: 'ğŸ“'; font-size: 20px; }

        .control-section { padding: 20px; border-bottom: 1px solid var(--border-color); }
        .section-title { font-size: 12px; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }

        .control-item { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; font-size: 14px; color: var(--text-main); }
        .control-item:last-child { margin-bottom: 0; }
        
        /* ç¾åŒ–è¾“å…¥æ¡† */
        input[type="text"], textarea {
            padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; 
            font-size: 14px; font-family: inherit; transition: all 0.2s; background: #f9fafb;
        }
        input[type="text"]:focus, textarea:focus { 
            border-color: var(--primary-color); background: #fff; 
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); outline: none; 
        }
        #titleInput { font-weight: 700; font-size: 15px; }

        /* ç¾åŒ–æ»‘å—æ§ä»¶ (Webkit Only) */
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 6px; background: var(--border-color);
            border-radius: 3px; outline: none; margin: 10px 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px; background: var(--primary-color);
            border-radius: 50%; cursor: pointer; border: 2px solid #fff; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.1); }

        /* ç¾åŒ–é¢œè‰²é€‰æ‹©å™¨å¤–å£³ */
        .color-wrapper {
            display: flex; align-items: center; gap: 10px; padding: 6px;
            border: 1px solid var(--border-color); border-radius: 8px; background: #f9fafb;
        }
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 36px; height: 36px; padding: 0;
            border-radius: 50%; overflow: hidden; cursor: pointer; box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; }

        .range-label { display: flex; justify-content: space-between; font-size: 13px; color: var(--text-sub); }

        .btn-print {
            margin: 20px; padding: 14px; background: var(--primary-color); color: white; border: none;
            border-radius: 10px; font-weight: 700; font-size: 16px; cursor: pointer;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-print:hover { background-color: #4338ca; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .btn-print::before { content: 'ğŸ–¨ï¸'; font-size: 18px; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            #viewport { padding: 0; height: auto; overflow: visible; }
            .page { margin: 0; box-shadow: none; width: 210mm; height: 297mm; page-break-after: always; background-image: none; }
        }
    </style>
</head>
<body>

<div id="viewport">
    <div id="content"></div>
</div>

<div class="panel no-print">
    <div class="panel-header">
        <h2>å­—å¸–é…ç½®å°</h2>
    </div>
    
    <div class="control-section">
        <div class="section-title">å†…å®¹ç¼–è¾‘</div>
        <div class="control-item">
            <input type="text" id="titleInput" value="çœ‹æ‹¼éŸ³å†™è¯è¯­ç»ƒä¹ " oninput="updateUI()" placeholder="è¾“å…¥å­—å¸–æ ‡é¢˜...">
        </div>
        <div class="control-item">
            <textarea id="input" rows="6" oninput="updateUI()" placeholder="è¾“å…¥æ‹¼éŸ³ï¼Œç©ºæ ¼åˆ†å­—ï¼Œé€—å·åˆ†è¯...">nÇ hÇo, xÃ¬ng fÃº, mÄ›i lÇ, xuÃ© xÃ­, shÅ« xiÄ›, rÃ¨n zhÄ“n, huÃ­ jiÄ</textarea>
        </div>
    </div>

    <div class="control-section">
        <div class="section-title">æ ·å¼ä¸å¸ƒå±€</div>
        <div class="control-item">
            <div class="range-label"><span>æ ¼å­å¤§å°</span><span id="sizeVal">18mm</span></div>
            <input type="range" id="size" min="15" max="30" value="18" oninput="updateUI()">
        </div>
        <div class="control-item">
            <div class="range-label"><span>è¡Œé—´è·</span><span id="rgVal">12mm</span></div>
            <input type="range" id="rg" min="8" max="30" value="12" oninput="updateUI()">
        </div>
        <div class="control-item">
            <div class="color-wrapper">
                <input type="color" id="color" value="#d32f2f" oninput="updateUI()">
                <span style="font-size: 13px; color: var(--text-sub);">ä¸»é¢˜è‰² (æ ¼å­ä¸è™šçº¿)</span>
            </div>
        </div>
    </div>

    <button class="btn-print" onclick="window.print()">ç¡®è®¤æ‰“å° A4</button>
    <p style="text-align: center; color: var(--text-sub); font-size: 12px; margin-bottom: 20px;">* æ‰“å°æ—¶è¯·å‹¾é€‰â€œèƒŒæ™¯å›¾å½¢â€ä»¥æ˜¾ç¤ºè™šçº¿</p>
</div>

<script>
    // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡ä»¥æ¸²æŸ“é»˜è®¤å†…å®¹
    document.addEventListener('DOMContentLoaded', updateUI);

    function updateUI() {
        const root = document.documentElement;
        const size = document.getElementById('size').value;
        const rg = document.getElementById('rg').value;
        const color = document.getElementById('color').value;

        document.getElementById('sizeVal').innerText = size + 'mm';
        document.getElementById('rgVal').innerText = rg + 'mm';

        root.style.setProperty('--grid-size', size + 'mm');
        root.style.setProperty('--row-gap', rg + 'mm');
        root.style.setProperty('--grid-color', color);
        
        // åŠ¨æ€ä¿®æ”¹ SVG é¢œè‰² (å¯¹ URL ç¼–ç )
        const svgColor = encodeURIComponent(color);
        const newBg = `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='${svgColor}' stroke-width='1.2' stroke-dasharray='5,4'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='${svgColor}' stroke-width='1.2' stroke-dasharray='5,4'/%3E%3C/svg%3E")`;
        
        let styleTag = document.getElementById('dynamic-style');
        if (!styleTag) {
            styleTag = document.createElement('style');
            styleTag.id = 'dynamic-style';
            document.head.appendChild(styleTag);
        }
        styleTag.innerHTML = `.type-tian { background-image: ${newBg} !important; }`;

        render();
    }

    function render() {
        const content = document.getElementById('content');
        // ä½¿ç”¨ç¤ºä¾‹æ–‡æœ¬å¦‚æœè¾“å…¥ä¸ºç©º
        let text = document.getElementById('input').value.trim();
        if (!text) text = "nÇ hÇo, xÃ¬ng fÃº"; 

        const title = document.getElementById('titleInput').value || "æ‹¼éŸ³ç»ƒä¹ ";
        
        content.innerHTML = '';
        let page = createPage(title);
        content.appendChild(page);
        let area = page.querySelector('.render-area');

        text.split(/[,ï¼Œ]/).forEach(word => {
            const trimmed = word.trim();
            if(!trimmed) return;
            const group = document.createElement('div');
            group.className = 'word-group';
            trimmed.split(/\s+/).forEach(syl => {
                const unit = document.createElement('div');
                unit.className = 'char-unit';
                unit.innerHTML = `<div class="pinyin">${syl}</div><div class="tian-zi-ge type-tian"></div>`;
                group.appendChild(unit);
            });
            area.appendChild(group);
            
            // é¢„ç•™ä¸€ç‚¹ç¼“å†²ç©ºé—´ (2px) é¿å…ä¸´ç•Œå€¼é—ªçƒ
            if (area.scrollHeight > area.clientHeight + 2) { 
                page = createPage(title);
                content.appendChild(page);
                area = page.querySelector('.render-area');
                area.appendChild(group);
            }
        });
    }

    function createPage(titleText) {
        const div = document.createElement('div');
        div.className = 'page';
        div.innerHTML = `
            <div class="page-header-title">${titleText}</div>
            <div class="info-bar">
                <div class="info-item">å§“åï¼š<span>__________</span></div>
                <div class="info-item">æ—¥æœŸï¼š<span>202_._._</span></div>
                <div class="info-item">å¾—åˆ†ï¼š<span>__________</span></div>
            </div>
            <div class="render-area"></div>
            <div class="page-footer"></div>
        `;
        return div;
    }
</script>
</body>
</html>
