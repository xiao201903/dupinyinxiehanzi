<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>教材级拼音字帖生成器</title>
    <style>
        :root {
            --grid-size: 18mm;
            --p-top: 20mm; --p-bottom: 20mm; --p-left: 20mm; --p-right: 20mm;
            --row-gap: 12mm;
            --grid-color: #d32f2f; /* 柔和的墨红色 */
            --pinyin-font: "楷体", "STKaiti", "KaiTi", serif;
        }
        
        body { margin: 0; background: #f0f2f5; font-family: -apple-system, "Helvetica Neue", sans-serif; display: flex; justify-content: flex-start; }
        
        /* 预览区域 */
        #viewport { flex-grow: 1; height: 100vh; overflow-y: auto; padding: 20px 0; display: flex; flex-direction: column; align-items: center; }

        .page {
            width: 210mm; height: 297mm;
            padding: var(--p-top) var(--p-right) var(--p-bottom) var(--p-left);
            background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            box-sizing: border-box; display: flex; flex-direction: column; 
            position: relative; page-break-after: always; margin-bottom: 30px;
        }

        /* 顶部装饰线 */
        .info-bar {
            display: flex; justify-content: space-between; font-size: 14px; color: #555;
            border-bottom: 1.5px solid var(--grid-color); padding-bottom: 6px; margin-bottom: 10mm;
        }

        .render-area {
            display: flex; flex-wrap: wrap; gap: var(--row-gap) 8mm; align-content: flex-start; flex-grow: 1;
        }

        .page-footer {
            position: absolute; bottom: 10mm; left: 0; right: 0; text-align: center;
            font-size: 12px; color: #999; letter-spacing: 2px;
        }
        .page-footer::after { counter-increment: pageCounter; content: "- 第 " counter(pageCounter) " 页 -"; }

        .word-group { display: flex; break-inside: avoid; }
        .char-unit { display: flex; flex-direction: column; align-items: center; }

        .pinyin { 
            height: 12mm; font-family: var(--pinyin-font); font-size: 24pt; 
            color: #333; margin-bottom: 2mm; display: flex; align-items: flex-end; 
        }

        /* 田字格 - 核心修改：使用 SVG 实现精准虚线 */
        .tian-zi-ge { 
            width: var(--grid-size); height: var(--grid-size); 
            border: 2px solid var(--grid-color); /* 实线外框 */
            position: relative; box-sizing: border-box; margin-left: -2px;
        }
        .char-unit:first-child .tian-zi-ge { margin-left: 0; }

        /* 虚线背景逻辑 */
        .type-tian {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='%23d32f2f' stroke-width='1.5' stroke-dasharray='4,4'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='%23d32f2f' stroke-width='1.5' stroke-dasharray='4,4'/%3E%3C/svg%3E");
        }
        .type-mi {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cline x1='50%25' y1='0' x2='50%25' y2='100%25' stroke='%23d32f2f' stroke-width='1.2' stroke-dasharray='4,4'/%3E%3Cline x1='0' y1='50%25' x2='100%25' y2='50%25' stroke='%23d32f2f' stroke-width='1.2' stroke-dasharray='4,4'/%3E%3Cline x1='0' y1='0' x2='100%25' y2='100%25' stroke='%23d32f2f' stroke-width='1' stroke-dasharray='4,4'/%3E%3Cline x1='100%25' y1='0' x2='0' y2='100%25' stroke='%23d32f2f' stroke-width='1' stroke-dasharray='4,4'/%3E%3C/svg%3E");
        }

        /* 右侧控制台 */
        .panel {
            width: 320px; height: 100vh; background: white; border-left: 1px solid #ddd;
            padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; gap: 15px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.05); position: sticky; top: 0;
        }
        h2 { font-size: 18px; color: #333; margin: 0 0 10px 0; border-left: 4px solid var(--grid-color); padding-left: 10px; }
        .item { display: flex; flex-direction: column; gap: 5px; font-size: 13px; color: #666; }
        input[type="range"] { accent-color: var(--grid-color); cursor: pointer; }
        textarea { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 14px; outline: none; transition: 0.3s; }
        textarea:focus { border-color: var(--grid-color); }
        .btn-print { background: var(--grid-color); color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-print:hover { opacity: 0.9; transform: translateY(-1px); }

        @media print {
            .no-print { display: none !important; }
            body { background: white; display: block; }
            .page { margin: 0; box-shadow: none; border: none; }
            #viewport { padding: 0; display: block; height: auto; }
        }
    </style>
</head>
<body>

<div id="viewport">
    <div id="content"></div>
</div>

<div class="panel no-print">
    <h2>字帖配置</h2>
    
    <div class="item">
        <label>拼音内容 (空格分字，逗号分词)</label>
        <textarea id="input" rows="4" oninput="updateUI()">nǐ hǎo, xìng fú, měi lǐ, xué xí</textarea>
    </div>

    <div class="item">
        <label>格子类型</label>
        <select id="gridType" onchange="updateUI()" style="padding: 8px; border-radius: 6px;">
            <option value="type-tian">虚线田字格</option>
            <option value="type-mi">虚线米字格</option>
            <option value="type-box">纯方框</option>
        </select>
    </div>

    <div class="item">
        <label>格子大小: <span id="sizeVal">18</span>mm</label>
        <input type="range" id="size" min="12" max="35" value="18" oninput="updateUI()">
    </div>

    <hr style="width:100%; border:0; border-top:1px solid #eee;">
    
    <div class="item" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div>上边距: <span id="ptVal">20</span><input type="range" id="pt" min="5" max="45" value="20" oninput="updateUI()"></div>
        <div>下边距: <span id="pbVal">20</span><input type="range" id="pb" min="5" max="45" value="20" oninput="updateUI()"></div>
        <div>左边距: <span id="plVal">20</span><input type="range" id="pl" min="5" max="45" value="20" oninput="updateUI()"></div>
        <div>右边距: <span id="prVal">20</span><input type="range" id="pr" min="5" max="45" value="20" oninput="updateUI()"></div>
    </div>

    <div class="item">
        <label>行间距: <span id="rgVal">12</span>mm</label>
        <input type="range" id="rg" min="0" max="40" value="12" oninput="updateUI()">
    </div>

    <div class="item">
        <label>格子主题色</label>
        <input type="color" id="color" value="#d32f2f" oninput="updateUI()" style="width:100%; height:30px; border:none; padding:0; background:none;">
    </div>

    <button class="btn-print" onclick="window.print()">确认打印 A4</button>
</div>

<script>
    function updateUI() {
        const root = document.documentElement;
        
        // 绑定滑块数据
        const ids = { 'size': 'sizeVal', 'pt': 'p-top', 'pb': 'p-bottom', 'pl': 'p-left', 'pr': 'p-right', 'rg': 'row-gap' };
        for (let id in ids) {
            const val = document.getElementById(id).value;
            const display = document.getElementById(id + 'Val');
            if(display) display.innerText = val;
            
            const cssVar = id === 'size' ? '--grid-size' : (id === 'rg' ? '--row-gap' : '--' + ids[id]);
            root.style.setProperty(cssVar, val + 'mm');
        }

        const color = document.getElementById('color').value;
        root.style.setProperty('--grid-color', color);
        
        render();
    }

    function render() {
        const content = document.getElementById('content');
        const text = document.getElementById('input').value.trim();
        const type = document.getElementById('gridType').value;
        
        content.innerHTML = '';
        let page = createPage();
        content.appendChild(page);
        let area = page.querySelector('.render-area');

        text.split(/[,，]/).forEach(word => {
            const trimmed = word.trim();
            if(!trimmed) return;
            const group = document.createElement('div');
            group.className = 'word-group';
            trimmed.split(/\s+/).forEach(syl => {
                const unit = document.createElement('div');
                unit.className = 'char-unit';
                unit.innerHTML = `<div class="pinyin">${syl}</div><div class="tian-zi-ge ${type}"></div>`;
                group.appendChild(unit);
            });
            area.appendChild(group);
            
            // 溢出检测
            if (area.scrollHeight > area.clientHeight) { 
                page = createPage();
                content.appendChild(page);
                area = page.querySelector('.render-area');
                area.appendChild(group);
            }
        });
    }

    function createPage() {
        const div = document.createElement('div');
        div.className = 'page';
        div.innerHTML = `
            <div class="info-bar"><span>姓名：__________</span><span>得分：__________</span></div>
            <div class="render-area"></div>
            <div class="page-footer"></div>
        `;
        return div;
    }

    updateUI();
</script>
</body>
</html>
